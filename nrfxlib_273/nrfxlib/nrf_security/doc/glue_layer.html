

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>mbed TLS glue layer &mdash; nrfxlib 1.3.99 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../_static/js/ncs.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/common.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/nrfxlib.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Backend configurations" href="backend_config.html" />
    <link rel="prev" title="nrf_security backends" href="backends.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../README.html" class="icon icon-home"> nrfxlib
          

          
          </a>

          
            
            
              <div class="version">
                1.3.99
              </div>
            
          

          
<div id="searchbox" role="search">
  <div class="searchformwrapper">
    <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Libraries:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../bsdlib/README.html">BSD library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/README.html">Crypto Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mpsl/README.html">Multiprotocol Service Layer</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../README.html">Nordic Security Module</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="prerequisites.html">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="backends.html">nrf_security backends</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">mbed TLS glue layer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#support-and-priority">Support and priority</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enabling-the-mbed-tls-glue-layer">Enabling the mbed TLS glue layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mbed-tls-glue-layer-mechanisms">mbed TLS glue layer mechanisms</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="backend_config.html">Backend configurations</a></li>
<li class="toctree-l2"><a class="reference internal" href="adv_backend_config.html">Advanced backend configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="mbed_tls_header.html">User-provided mbed TLS config header</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html">API documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../nfc/README.html">Near Field Communication (NFC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openthread/README.html">OpenThread pre-built libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../softdevice_controller/README.html">SoftDevice Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../zboss/README.html">ZBOSS Zigbee stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nrf_rpc/README.html">Remote procedure call library (nRF RPC)</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../README.html">nrfxlib</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../README.html">Docs</a> &raquo;</li>
        
          <li><a href="../README.html">Nordic Security Module</a> &raquo;</li>
        
      <li>mbed TLS glue layer</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/nrf_security/doc/glue_layer.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="mbed-tls-glue-layer">
<span id="nrf-security-glue-layer"></span><h1>mbed TLS glue layer<a class="headerlink" href="#mbed-tls-glue-layer" title="Permalink to this headline">¶</a></h1>
<p>The mbed TLS glue layer allows for using both the hardware-accelerated and software implementation of cryptography at the same time.
A typical use case is if the cryptographic algorithm is limited in hardware support (for example, the AES key size or supported ciphers).
In this case, the mbed TLS glue layer enables a dynamic check to verify whether the cryptographic algorithm is supported in hardware.
If it is not supported, the glue layer calls into a different enabled backend as a fallback.</p>
<p>The mbed TLS glue layer is written by Nordic Semiconductor ASA and is a part of the nrf_security module.
The mbed TLS glue layer is dependent on Kconfig variables in the nRF Connect SDK build system.</p>
<div class="section" id="support-and-priority">
<h2>Support and priority<a class="headerlink" href="#support-and-priority" title="Permalink to this headline">¶</a></h2>
<p>To select the backend, the mbed TLS glue layer implements a functionality check with priority reporting.
The check is performed using a <cite>check function</cite>.
This function is called from the API which provides configuration changes that determine the selection between the enabled backends.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Example: cc310 backend AES CCM support and priority check</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">mbedtls_ccm_check</span><span class="p">(</span><span class="n">mbedtls_cipher_id_t</span> <span class="n">cipher</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">keybits</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">keybits</span> <span class="o">==</span> <span class="mi">128</span><span class="p">)</span> <span class="o">?</span> <span class="mi">3</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>In this example, the AES CCM support in the backend will report priority level 3 if the key size is 128, or 0 if the key size is different.
The <a class="reference internal" href="backends.html#nrf-security-backends-cc-310"><span class="std std-ref">Arm CryptoCell cc310 backend</span></a> does not support a larger key size.
If the key size is larger than 128 bits, then another enabled backend is used.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The check function can be called from multiple APIs in the mbed TLS glue layer.
An example of a location that determines backend selection is an API to set an encryption key, in which case the key size may change, demanding a new selection of available and prioritized backends.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Hardware-accelerated cryptography through the <a class="reference internal" href="backends.html#nrf-security-backends-cc-310"><span class="std std-ref">Arm CryptoCell cc310 backend</span></a> is prioritized if it is supported.</p>
</div>
</div>
<div class="section" id="enabling-the-mbed-tls-glue-layer">
<h2>Enabling the mbed TLS glue layer<a class="headerlink" href="#enabling-the-mbed-tls-glue-layer" title="Permalink to this headline">¶</a></h2>
<p>The mbed TLS glue layer is automatically enabled when two backends are enabled for one or more of the following groups of algorithms:</p>
<ul class="simple">
<li><p>AES (ECB, CBC, CTR, and CCM/CCM*)</p></li>
<li><p>CMAC</p></li>
<li><p>DHM</p></li>
</ul>
</div>
<div class="section" id="mbed-tls-glue-layer-mechanisms">
<h2>mbed TLS glue layer mechanisms<a class="headerlink" href="#mbed-tls-glue-layer-mechanisms" title="Permalink to this headline">¶</a></h2>
<p>The mbed TLS glue layer relies on symbol renaming of known APIs in mbed TLS to prevent collisions of identically named functions in multiple backends.
The backend implementation is reached using a table of function pointers corresponding to the renamed symbols.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Example: cc310 backend ECDH function table</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="n">mbedtls_ecdh_funcs</span> <span class="n">mbedtls_ecdh_cc310_backend_funcs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">.</span><span class="n">check</span> <span class="o">=</span> <span class="n">mbedtls_ecdh_check</span><span class="p">,</span>
        <span class="p">.</span><span class="n">gen_public</span> <span class="o">=</span> <span class="n">mbedtls_ecdh_gen_public</span><span class="p">,</span>
        <span class="p">.</span><span class="n">compute_shared</span> <span class="o">=</span> <span class="n">mbedtls_ecdh_compute_shared</span><span class="p">,</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<p><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">mbedtls_ecdh_cc310_backend_funcs()</span></code> points to mbed TLS APIs in <a class="reference internal" href="../../crypto/doc/nrf_cc310_mbedcrypto.html#nrf-cc310-mbedcrypto-readme"><span class="std std-ref">nrf_cc310_mbedcrypto library</span></a> which is renamed if mbed TLS glue layer is enabled.
The function pointers <cite>gen_public</cite> and <cite>compute_shared</cite> have signatures equal to the corresponding mbed TLS APIs.</p>
<p>The complete list of APIs that can be renamed in the mbed TLS glue layer can be found in <code class="file docutils literal notranslate"><span class="pre">nrfxlib/nrf_security/src/mbedcrypto_glue/symbol_rename.template.txt</span></code></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="backend_config.html" class="btn btn-neutral float-right" title="Backend configurations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="backends.html" class="btn btn-neutral" title="nrf_security backends" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">

<table>
<tr>
<td>
    <p>
        &copy; Copyright 2019-2020, Nordic Semiconductor.
      Last updated on Sep 30, 2020.

    </p>
</td>
<td id="nordiclogo">
  <a href="https://www.nordicsemi.com/"><img src="../../_static/images/nordic.svg" border="0"/></a>
</td>
</tr>
</table>
  </div> 


</footer>
        </div>
      </div>

    </section>

  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> nrfxlib</span>
       <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <div class="rst-other-version ncs">
        <a href="../../../nrf/index.html">nRF Connect SDK</a>
      </div>
      <div class="rst-other-version zephyr">
        <a href="../../../zephyr/index.html">Zephyr</a><br/>
      </div>
      <div class="rst-other-version mcuboot">
        <a href="../../../mcuboot/wrapper.html">MCUboot</a>
      </div>
      <div class="rst-other-version kconfig">
        <a href="../../../kconfig/index.html">Kconfig Reference</a>
      </div>
    </div>
  </div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>